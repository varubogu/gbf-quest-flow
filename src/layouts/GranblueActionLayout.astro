---
import FlowBaseLayout from "./FlowBaseLayout.astro";

interface Props {
  title: string;
}

const { title } = Astro.props;
---

<FlowBaseLayout title={title}>
  <!-- グリッドコンテナを3行に分割。中央行がドラッグ可能な仕切り -->
  <div id="resizableContainer" class="h-[calc(100vh-3.5rem)] grid" style="grid-template-rows: 1fr 8px 1fr;">
    <!-- 上部の内容 -->
    <div class="p-4 overflow-auto">
      <h2 class="text-lg font-medium mb-4">常に意識すること</h2>
      <slot name="awareness" />
    </div>

    <!-- ドラッグハンドル（仕切り） -->
    <div id="resizer" class="bg-gray-300 cursor-row-resize"></div>

    <!-- 下部の内容 -->
    <div class="overflow-hidden">
      <slot name="action-table" />
    </div>
  </div>

  <!-- ドラッグ操作のためのスクリプト -->
  <script>
    const resizer = document.getElementById('resizer');
    const container = document.getElementById('resizableContainer');
    let startY, topRowHeight, bottomRowHeight;

    // マウスイベントとタッチイベントで共通してY座標を取得するヘルパー関数
    function getClientY(e) {
      // e.clientY があればマウスイベント、なければタッチイベントから取得
      return e.clientY || (e.touches && e.touches[0] ? e.touches[0].clientY : 0);
    }

    // ドラッグ開始（マウス：mousedown / タッチ：touchstart）
    function initDrag(e) {
      // タッチイベントの場合、不要なスクロールを防ぐための処理
      e.preventDefault();

      startY = getClientY(e);
      const computedStyle = window.getComputedStyle(container);
      const rows = computedStyle.gridTemplateRows.split(' ');
      topRowHeight = parseFloat(rows[0]);
      bottomRowHeight = parseFloat(rows[2]);

      document.addEventListener('mousemove', drag, false);
      document.addEventListener('touchmove', drag, false);
      document.addEventListener('mouseup', stopDrag, false);
      document.addEventListener('touchend', stopDrag, false);
    }

    // ドラッグ中の処理（マウス：mousemove / タッチ：touchmove）
    function drag(e) {
      const clientY = getClientY(e);
      const dy = clientY - startY;
      const newTop = topRowHeight + dy;
      const newBottom = bottomRowHeight - dy;

      // 最低高さの制限（必要に応じて変更）
      if (newTop < 50 || newBottom < 50) return;

      container.style.gridTemplateRows = `${newTop}px 8px ${newBottom}px`;
    }

    // ドラッグ終了（マウス：mouseup / タッチ：touchend）
    function stopDrag() {
      document.removeEventListener('mousemove', drag, false);
      document.removeEventListener('touchmove', drag, false);
      document.removeEventListener('mouseup', stopDrag, false);
      document.removeEventListener('touchend', stopDrag, false);
    }

    resizer.addEventListener('mousedown', initDrag, false);
    resizer.addEventListener('touchstart', initDrag, false);
  </script>
</FlowBaseLayout>